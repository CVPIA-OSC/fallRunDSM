---
title: "Calibrating Fall Run DSM"
output: html_notebook
---

## Objective

We are using genetic algorithms, a type of stochastic optimization, to calibrate the following model coefficients:

* `..surv_adult_enroute_int`
* `..surv_adult_prespawn_int`
* `..surv_egg_to_fry_int`
* `..surv_juv_rear_int`
* `..surv_juv_rear_contact_points`
* `..surv_juv_rear_prop_diversions`
* `..surv_juv_rear_total_diversions`
* `..surv_juv_bypass_int`
* `..surv_juv_delta_int`
* `..surv_juv_delta_contact_points`
* `..surv_juv_delta_total_diverted`
* `..surv_juv_outmigration_sj_int`
* `..surv_juv_outmigration_sac_int_one`
* `..surv_juv_outmigration_sac_prop_diversions`
* `..surv_juv_outmigration_sac_total_diversions`
* `..surv_juv_outmigration_sac_int_two`
* `..ocean_entry_success_int`


## Packages
```{r}
library(GA)
library(fallRunDSMCalibration)
library(DSMCalibrationData)
library(tidyverse)
```
We are using the [GA](http://luca-scr.github.io/GA/index.html) R package to implement our genetic algorithms search
and the [fallRunDSMCalibration](https://github.com/CVPIA-OSC/fallRunDSMCalibration) R package that contains
a version of [fallRunDSM](https://github.com/CVPIA-OSC/fallRunDSM) that has exposed the above model coefficients
in the `fall_run_model` function to enable optimization of these coefficients.
Additionally, we are using [DSMCalibrationData](https://github.com/CVPIA-OSC/DSMCalibrationData) to access calibration
related data.

**NEED TO BUILD DOCUMENTATION SITES FOR THESE AND UPDATE LINKS**


## Calibrating Data
We will be minimizing the error between [GrandTab](https://wildlife.ca.gov/Conservation/Fishes/Chinook-Salmon/Anadromous-Assessment) estimated escapement data for the years 1998-2017 and escapement predicted by the DSM. The data inputs to the DSM are for years 1980-1999. We selected proxy years for 1998-2017
from the 1980-1999 model inputs by [comparing the DWR water year indices](https://cdec.water.ca.gov/reportapp/javareports?name=WSIHIST) in this [analysis](https://github.com/CVPIA-OSC/DSMCalibrationData/blob/main/data-raw/synthetic_years.R).

### Selected Proxy Years
```{r echo=FALSE}
tibble(
  `Calibration Year` = names(DSMCalibrationData::calibration_year_lookup), 
  `Selected Proxy Year` = DSMCalibrationData::calibration_year_lookup) 
```

### GrandTab Data
which watersheds?
display table of data
```{r}

```


## Fitness Function
```{r}

```
