<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DSM Hatchery Analysis Documentation  â€¢ fallRunDSM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="DSM Hatchery Analysis Documentation ">
<meta property="og:description" content="fallRunDSM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fallRunDSM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/hatchery-analysis.html">Hatchery Analysis</a>
    </li>
    <li>
      <a href="../articles/temperature-model.html">Temperature Modeling</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CVPIA-OSC/fallRunDSM">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="hatchery-analysis_files/header-attrs-2.8/header-attrs.js"></script><script src="hatchery-analysis_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="hatchery-analysis_files/jquery-3.5.1/jquery.min.js"></script><link href="hatchery-analysis_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="hatchery-analysis_files/datatables-binding-0.18/datatables.js"></script><link href="hatchery-analysis_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="hatchery-analysis_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="hatchery-analysis_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="hatchery-analysis_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="hatchery-analysis_files/crosstalk-1.1.1/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>DSM Hatchery Analysis Documentation</h1>
            
      
      
      <div class="hidden name"><code>hatchery-analysis.Rmd</code></div>

    </div>

    
    
<div id="description" class="section level2">
<h2 class="hasAnchor">
<a href="#description" class="anchor"></a>Description</h2>
<p>This analysis provides the <code>hatchery_allocation</code> and <code>natural_adult_removal_rate</code> inputs to the FallRunDSM.</p>
<div id="datasource" class="section level3">
<h3 class="hasAnchor">
<a href="#datasource" class="anchor"></a>Datasource</h3>
<p>Temporal Range: 2010 - 2012</p>
<p>Most data from CWT (coded wire tag) analyses with limited data in 2010 from CVPIA ChinookProd database version 2 September 22, 2017. Data from these sources was compiled in a csv called <a href="https://dsm-docs.s3-us-west-2.amazonaws.com/adult_hatchery_documentation/hatchery_fish_fate2010_2012.csv">hatchery_fish_fate2010_2012.csv</a>.</p>
<p><strong>Adjustment to Feather and Yuba Rivers:</strong></p>
<p>Feather and Yuba Rivers do not separate spring and fall run in totals, here we apply the proportion of spring hatchery return adults that are used to adjust the totals for 2010 - 2012. Data used for Feather and Yuba adjustment were from <a href="https://dsm-docs.s3-us-west-2.amazonaws.com/adult_hatchery_documentation/GrandTab.2017.04.07.pdf">GrandTab 2017 version.</a></p>
<p>The datatable below shows the data that has been prepped for analysis. (<code>No_hatch_returns</code> corresponds to the number of hatchery fish returning, <code>Hatch_flag</code> describes if fish are hatchery(1) or not hatchery(0))</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cwt_data</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"hatchery-data"</span>, <span class="st">"hatchery_fish_fate2010_2012.csv"</span>, 
                       package <span class="op">=</span> <span class="st">"fallRunDSM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span><span class="st">"Hatch_flag"</span> <span class="op">=</span> <span class="va">Hatch.flag</span><span class="op">)</span>

<span class="va">proportion_spring_run</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.076777295</span>, <span class="fl">0.056932196</span>, <span class="fl">0.081441457</span><span class="op">)</span>, 
                                       Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2010</span>, <span class="fl">2011</span>, <span class="fl">2012</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Apply fall proportions * (1- spring proportion) to feather and yuba </span>
<span class="va">spring_run_feather_yuba</span> <span class="op">&lt;-</span> <span class="va">cwt_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Run</span> <span class="op">==</span> <span class="st">"Fall/Spr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">proportion_spring_run</span>, by <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>No_hatch_ret <span class="op">=</span> <span class="va">No_hatch_ret</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">prp</span><span class="op">)</span>,
         Total_escape <span class="op">=</span> <span class="va">Total_escape</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">prp</span><span class="op">)</span>,
         Run <span class="op">=</span> <span class="st">"Fall"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">prp</span><span class="op">)</span>

<span class="co"># Apply fall proportions * (spring proportion) to feather and yuba </span>
<span class="va">fall_run_feather_yuba</span> <span class="op">&lt;-</span> <span class="va">cwt_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Run</span> <span class="op">==</span> <span class="st">"Fall/Spr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">proportion_spring_run</span>, by <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>No_hatch_ret <span class="op">=</span> <span class="va">No_hatch_ret</span> <span class="op">*</span> <span class="va">prp</span>,
         Total_escape <span class="op">=</span> <span class="va">Total_escape</span> <span class="op">*</span> <span class="va">prp</span>,
         Run <span class="op">=</span> <span class="st">"Spring"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">prp</span><span class="op">)</span>
  
<span class="co"># Remove initial "Fall/Spr" data from hatchery data and then bind new spring fall data on</span>
<span class="va">cwt_data</span> <span class="op">&lt;-</span> <span class="va">cwt_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Run</span> <span class="op">!=</span> <span class="st">"Fall/Spr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">spring_run_feather_yuba</span>, <span class="va">fall_run_feather_yuba</span><span class="op">)</span>

<span class="fu">datatable</span><span class="op">(</span><span class="va">cwt_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Run</span> <span class="op">==</span> <span class="st">"Fall"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">Run</span><span class="op">)</span>, 
          options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                    searching <span class="op">=</span> <span class="cn">FALSE</span>,
                    pageLength <span class="op">=</span> <span class="fl">5</span>,
                    lengthMenu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-9b36f130588f5f2d36c4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9b36f130588f5f2d36c4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72"],["American River","American River","American River","Antelope Creek","Battle Creek","Battle Creek","Battle Creek","Big Chico Creek","Butte Creek","Butte Creek","Butte Creek","Calaveras River","Calaveras River","Calaveras River","Clear Creek","Clear Creek","Clear Creek","Coleman National Fish Hatchery","Coleman National Fish Hatchery","Coleman National Fish Hatchery","Cosumnes River","Cosumnes River","Cottonwood Creek","Cottonwood Creek","Cottonwood Creek","Cow Creek","Cow Creek","Cow Creek","Deer Creek","Deer Creek","Deer Creek","Feather River Hatchery","Feather River Hatchery","Feather River Hatchery","Merced River","Merced River","Merced River","Merced River Fish Facility","Merced River Fish Facility","Merced River Fish Facility","Mill Creek","Mill Creek","Mill Creek","Mokelumne Hatchery","Mokelumne Hatchery","Mokelumne Hatchery","Mokelumne River","Mokelumne River","Mokelumne River","Mokelumne Weir","Nimbus Fish Hatchery","Nimbus Fish Hatchery","Nimbus Fish Hatchery","Nimbus Weir","Nimbus Weir","Nimbus Weir","Paynes Creek","Stanislaus River","Stanislaus River","Stanislaus River","Tuolumne River","Tuolumne River","Tuolumne River","Upper Sacramento River","Upper Sacramento River","Upper Sacramento River","Feather River","Feather River","Feather River","Yuba River","Yuba River","Yuba River"],[0.325,0.66,0.73,0.2,0.9,0.89,0.91,0.2,0.2,0.07,0.12,0,0.14,0.09,0.04,0.08,0.4,0.89,0.89,0.91,0,0.04,0.2,0.58,0.32,0.2,0.2,0.2,0.2,0.2,0.2,0.82,0.96,0.96,0.78,0.89,0.87,0.79,0.88,0.79,0.2,0.07,0.03,0.9,0.98,0.96,0.73,0.88,0.78,0.74,0.79,0.77,0.85,0.38,0.26,0.67,0.2,0.5,0.83,0.83,0.49,0.73,0.36,0.2,0.27,0.67,0.78,0.9,0.9,0.72,0.65,0.45],[0.675,0.34,0.27,0.8,0.1,0.11,0.09,0.8,0.8,0.93,0.88,1,0.86,0.91,0.96,0.92,0.6,0.11,0.11,0.09,1,0.96,0.8,0.42,0.68,0.8,0.8,0.8,0.8,0.8,0.8,0.18,0.04,0.04,0.22,0.11,0.13,0.21,0.12,0.21,0.8,0.93,0.97,0.1,0.02,0.04,0.27,0.12,0.22,0.26,0.21,0.23,0.15,0.62,0.74,0.33,0.8,0.5,0.17,0.17,0.51,0.27,0.64,0.8,0.73,0.33,0.22,0.1,0.1,0.28,0.35,0.55],[7573,21320,34900,50,6632,12867,31360,50,370,419,813,0,465,132,7192,4841,7631,17238,42380,84289,740,1071,1137,2144,2556,536,1810,1488,166,662,873,19972,32616,42161,651,1615,2257,146,437,1000,144,1485,890,5276,15922,6620,1920,2667,5471,244,9095,12680,9257,7115,3917,3923,50,1086,1063,4006,540,878,783,16372,10583,22435,41465.62457237,44596.733383356,58465.332703407,12091.447767385,7283.312650292,6107.495752407],[2010,2011,2012,2010,2010,2011,2012,2010,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2010,2011,2012,2010,2011,2012,2010,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012,2010,2011,2012],[2461.225,14071.2,25477,10,5968.8,11451.63,28537.6,10,74,29.33,97.56,0,65.1,11.88,287.68,387.28,3052.4,15341.82,37718.2,76702.99,0,42.84,227.4,1243.52,817.92,107.2,362,297.6,33.2,132.4,174.6,16377.04,31311.36,40474.56,507.78,1437.35,1963.59,115.34,384.56,790,28.8,103.95,26.7,4748.4,15603.56,6355.2,1401.6,2346.96,4267.38,180.56,7185.05,9763.6,7868.45,2703.7,1018.42,2628.41,10,543,882.29,3324.98,264.6,640.94,281.88,3274.4,2857.41,15031.45,32343.1871664486,40137.0600450204,52618.7994330663,8705.8423925172,4734.1532226898,2748.37308858315],["CWT report","CWT report","CWT report","Chinookprod","Chinookprod","CWT report","CWT report","Chinookprod","Chinookprod","CWT report","CWT report","Chinookprod","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","Chinookprod","CWT report","Chinookprod","CWT report","CWT report","Chinookprod","Chinookprod","Chinookprod","Chinookprod","Chinookprod","Chinookprod","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","Chinookprod","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","Chinookprod","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report","CWT report"],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Trib<\/th>\n      <th>Hatchery<\/th>\n      <th>Natural<\/th>\n      <th>Total_escape<\/th>\n      <th>Year<\/th>\n      <th>No_hatch_ret<\/th>\n      <th>Source<\/th>\n      <th>Hatch_flag<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"pageLength":5,"lengthMenu":[5,10,15,20],"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="hatchery-allocation" class="section level3">
<h3 class="hasAnchor">
<a href="#hatchery-allocation" class="anchor"></a>Hatchery Allocation</h3>
<p>The number of <code>hatch_adults</code> is determined in the <code>model.R</code> script through a multinominal distribution with the probability equal to the <code>hatchery_allocation</code> calculated below.</p>
<p>To find the <code>hatchery_allocation</code> we calculated the proportion of hatchery fish allocated to each tributary in each year, grouped our data by tributary and Run, and then summarized to find the mean percentage of hatchery fish for each tributary.</p>
<p>There are 5 tributaries missing data for Fall Run fish. We assign lowest proportion of Fall Run hatchery fish spawning in our observed dataset to these tributaries and we renormalize the values so that they all sum to 1.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fish_in_wild</span> <span class="op">&lt;-</span> <span class="va">cwt_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Run</span> <span class="op">==</span> <span class="st">"Fall"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Hatch_flag</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">wild_totals</span> <span class="op">&lt;-</span> <span class="va">fish_in_wild</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>total_hatch_spawn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">No_hatch_ret</span><span class="op">)</span><span class="op">)</span> 

<span class="va">fish_in_wild</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">fish_in_wild</span>, <span class="va">wild_totals</span>, by <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span>

<span class="va">summarized_fish_in_wild</span> <span class="op">&lt;-</span> <span class="va">fish_in_wild</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>trib_hatchery_percentage <span class="op">=</span> <span class="va">No_hatch_ret</span><span class="op">/</span><span class="va">total_hatch_spawn</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">Trib</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>mean_trib_hatchery_percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">trib_hatchery_percentage</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>  

<span class="va">hatchery_per_trib</span> <span class="op">&lt;-</span> <span class="va">summarized_fish_in_wild</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu">tibble</span><span class="op">(</span>Trib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Bear Creek"</span>, <span class="st">"Elder Creek"</span>, <span class="st">"Stony Creek"</span>, <span class="st">"Thomes Creek"</span>, <span class="st">"Bear River"</span><span class="op">)</span>,
               mean_trib_hatchery_percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">summarized_fish_in_wild</span><span class="op">$</span><span class="va">mean_trib_hatchery_percentage</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>mean_trib_hatchery_percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">mean_trib_hatchery_percentage</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mean_trib_hatchery_percentage</span>, 
                                                                                    na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span><span class="st">"Fall proportion allocated to tributary"</span> <span class="op">=</span> <span class="va">mean_trib_hatchery_percentage</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span><span class="fu">replace_na</span><span class="op">(</span><span class="va">.x</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">datatable</span><span class="op">(</span><span class="va">hatchery_per_trib</span>, 
          options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                    searching <span class="op">=</span> <span class="cn">FALSE</span>,
                    pageLength <span class="op">=</span> <span class="fl">8</span>,
                    lengthMenu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Trib"</span><span class="op">)</span>, textAlign <span class="op">=</span> <span class="st">'center'</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-6918abd145a98392d85e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6918abd145a98392d85e">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25"],["American River","Antelope Creek","Battle Creek","Big Chico Creek","Butte Creek","Calaveras River","Clear Creek","Cosumnes River","Cottonwood Creek","Cow Creek","Deer Creek","Feather River","Merced River","Mill Creek","Mokelumne River","Paynes Creek","Stanislaus River","Tuolumne River","Upper Sacramento River","Yuba River","Bear Creek","Elder Creek","Stony Creek","Thomes Creek","Bear River"],[0.1336,0.0002,0.1509,0.0002,0.0008,0.0003,0.0106,0.0002,0.0084,0.0028,0.0012,0.4829,0.0136,0.0007,0.0282,0.0002,0.0148,0.0049,0.0672,0.0776,0.0002,0.0002,0.0002,0.0002,0.0002]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Trib<\/th>\n      <th>Fall proportion allocated to tributary<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"pageLength":8,"lengthMenu":[8,10,15,20],"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
<div id="natural-adult-removal-rate" class="section level3">
<h3 class="hasAnchor">
<a href="#natural-adult-removal-rate" class="anchor"></a>Natural Adult Removal Rate</h3>
<p><code>natural_adult_removal_rate</code> is used in the fallRunDSM by the <code><a href="../reference/get_spawning_adults.html">get_spawning_adults()</a></code> function. The number of <code>natural_adults_by_month</code> is determined binomial distribution with the probability equal to the <code>1 - natural_adult_removal_rate</code>.</p>
<p>We calculate the natural adult removal rate for each tributary by estimating the proportion of naturally produced fish used in a hatchery (i.e., they did not spawn).</p>
<p>For Fall Run <code>natural_adult_removal_rate</code> there are 5 tributaries where fish are removed for use in hatcheries.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fall natural adult removal -------------------------------------------------------------------------------------</span>
<span class="va">fall_hatchery_fish</span> <span class="op">&lt;-</span> <span class="va">cwt_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Hatch_flag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">Run</span> <span class="op">==</span> <span class="st">"Fall"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>remove <span class="op">=</span> <span class="va">Natural</span> <span class="op">*</span> <span class="va">Total_escape</span><span class="op">)</span>

<span class="va">pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Coleman National Fish Hatchery"</span>, <span class="st">"Battle Creek"</span>,
                  <span class="st">"Feather River Hatchery"</span>, <span class="st">"Feather River"</span>, <span class="st">"Merced River Fish Facility"</span>, 
                  <span class="st">"Merced River"</span>, <span class="st">"Nimbus Fish Hatchery"</span>, <span class="st">"American River"</span>, <span class="st">"Mokelumne Hatchery"</span>, 
                  <span class="st">"Mokelumne River"</span><span class="op">)</span>, 
                ncol<span class="op">=</span><span class="fl">2</span>, 
                byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">fall_fish_removal</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span>
  <span class="va">keep_in_hatchery</span> <span class="op">&lt;-</span> <span class="va">fall_hatchery_fish</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Trib</span> <span class="op">==</span> <span class="va">pairs</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">arrange</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span>
  
  <span class="va">remove_from_trib</span> <span class="op">&lt;-</span> <span class="va">cwt_data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Run</span> <span class="op">==</span> <span class="st">"Fall"</span> <span class="op">&amp;</span> <span class="va">Trib</span> <span class="op">==</span> <span class="va">pairs</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">arrange</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>natural_removed <span class="op">=</span> <span class="va">Natural</span> <span class="op">*</span> <span class="va">Total_escape</span><span class="op">)</span> 
  
  <span class="va">fall_proportion_removed</span> <span class="op">&lt;-</span> <span class="va">keep_in_hatchery</span><span class="op">$</span><span class="va">remove</span><span class="op">/</span><span class="op">(</span><span class="va">keep_in_hatchery</span><span class="op">$</span><span class="va">remove</span> <span class="op">+</span> <span class="va">remove_from_trib</span><span class="op">$</span><span class="va">natural_removed</span><span class="op">)</span>
  <span class="va">fall_fish_removal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">fall_fish_removal</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Trib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">pairs</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">fall_proportion_removed</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Combine run removal rates </span>
<span class="va">natural_adult_removal_rate</span> <span class="op">&lt;-</span> <span class="va">fall_fish_removal</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">Trib</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span><span class="st">"Fall Proportion Removed"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">fall_proportion_removed</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span><span class="fu">replace_na</span><span class="op">(</span><span class="va">.x</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Display it all </span>
<span class="fu">datatable</span><span class="op">(</span><span class="va">natural_adult_removal_rate</span>, 
          options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                    searching <span class="op">=</span> <span class="cn">FALSE</span>,
                    pageLength <span class="op">=</span> <span class="fl">6</span>,
                    lengthMenu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Trib"</span><span class="op">)</span>, textAlign <span class="op">=</span> <span class="st">'center'</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-bec98ba9739f70d26932" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bec98ba9739f70d26932">{"x":{"filter":"none","data":[["1","2","3","4","5"],["American River","Battle Creek","Feather River","Merced River","Mokelumne River"],[0.229,0.746,0.244,0.274,0.394]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Trib<\/th>\n      <th>Fall Proportion Removed<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"pageLength":6,"lengthMenu":[6,10,15,20],"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by James Petterson, Adam Duarte, Sadie Gill, Emanuel Rodriguez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
